<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>API Teste - Dark Purple</title>
<style>
    /* Reset básico */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

    body {
        background-color: #121212;
        color: #eee;
        line-height: 1.6;
    }

    header {
        background-color: #1e1e2f;
        padding: 1.5rem;
        text-align: center;
        border-bottom: 3px solid #7b3cff;
        border-radius: 0 0 20px 20px;
    }

    header h1 { color: #7b3cff; }

    main { padding: 2rem; max-width: 1000px; margin: auto; }

    h2 { margin-bottom: 1rem; color: #7b3cff; }

    form {
        background-color: #1e1e2f;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border-radius: 15px;
        border: 2px solid #7b3cff;
        box-shadow: 0 4px 15px rgba(123, 60, 255, 0.2);
    }

    input, select, button {
        display: block;
        width: 100%;
        margin-bottom: 1rem;
        padding: 0.8rem;
        border-radius: 12px;
        border: 1px solid #444;
        background-color: #2a2a3b;
        color: #eee;
        font-size: 1rem;
        transition: 0.2s;
    }

    input:focus, select:focus { border-color: #7b3cff; outline: none; }

    button {
        background-color: #7b3cff;
        border: none;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
    }

    button:hover { background-color: #a56fff; }

    table {
        margin-top: 1rem;
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(123, 60, 255, 0.2);
    }

    th, td {
        border: 1px solid #444;
        padding: 0.8rem;
        text-align: left;
        background-color: #1e1e2f;
    }

    th { background-color: #2a2a3b; }

    img.avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
    }

    .section { margin-bottom: 3rem; }
</style>
</head>
<body>
<header>
    <h1>API Teste - Dark Purple</h1>
</header>
<main>
    <!-- Criar Usuário -->
    <section class="section">
        <h2>Criar Usuário</h2>
        <form id="userForm">
            <input type="text" name="name" placeholder="Nome do usuário" required>
            <input type="password" name="pass" placeholder="Senha" required>
            <input type="file" name="avatar" accept="image/*">
            <button type="submit">Criar Usuário</button>
        </form>
        <table class="users-list">
            <thead>
                <tr>
                    <th>ID</th><th>Nome</th><th>Avatar</th><th>Ações</th>
                </tr>
            </thead>
            <tbody id="usersTable"></tbody>
        </table>
    </section>

    <!-- Criar Licença -->
    <section class="section">
        <h2>Criar Licença</h2>
        <form id="licenseForm">
            <input type="text" name="userId" placeholder="ID do usuário" required>
            <select name="type">
                <option value="basic">Basic</option>
                <option value="premium">Premium</option>
                <option value="pro">Pro</option>
            </select>
            <input type="number" name="durationDays" placeholder="Duração (dias)" required>
            <button type="submit">Criar Licença</button>
        </form>
        <table class="licenses-list">
            <thead>
                <tr>
                    <th>Chave</th><th>Usuário ID</th><th>Tipo</th><th>Expiração</th><th>Ações</th>
                </tr>
            </thead>
            <tbody id="licensesTable"></tbody>
        </table>
    </section>
</main>

<script>
const API_URL = "https://keyer.camposcloud.app/api";

// --- Usuários ---
const userForm = document.getElementById('userForm');
const usersTable = document.getElementById('usersTable');

async function fetchUsers() {
    const res = await fetch(`${API_URL}/users`);
    const users = await res.json();
    usersTable.innerHTML = users.map(u => `
        <tr>
            <td>${u.id}</td>
            <td>${u.name}</td>
            <td><img class="avatar" src="${u.avatarUrl}" alt="avatar"></td>
            <td><button onclick="deleteUser(${u.id})">Deletar</button></td>
        </tr>
    `).join('');

}

async function deleteUser(id) {
    await fetch(`${API_URL}/users/${id}`, { method: 'DELETE' });
    fetchUsers();
}

userForm.addEventListener('submit', async e => {
    e.preventDefault();
    const formData = new FormData(userForm);
    const name = formData.get('name');
    const pass = formData.get('pass');
    const avatar = formData.get('avatar');

    const resUser = await fetch(`${API_URL}/users`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, pass })
    });
    const newUser = await resUser.json();

    if (avatar && avatar.size > 0) {
        const form = new FormData();
        form.append('avatar', avatar);
        await fetch(`${API_URL}/users/${newUser.id}/avatar`, { method: 'POST', body: form });
    }

    userForm.reset();
    fetchUsers();
});

// --- Licenças ---
const licenseForm = document.getElementById('licenseForm');
const licensesTable = document.getElementById('licensesTable');

async function fetchLicenses() {
    const res = await fetch(`${API_URL}/licenses`);
    const licenses = await res.json();
    licensesTable.innerHTML = licenses.map(l => `
        <tr>
            <td>${l.licenseKey}</td>
            <td>${l.userId}</td>
            <td>${l.type}</td>
            <td>${l.expirationDate}</td>
            <td><button onclick="deleteLicense('${l.licenseKey}')">Deletar</button></td>
        </tr>
    `).join('');
}

async function deleteLicense(key) {
    await fetch(`${API_URL}/licenses/${key}`, { method: 'DELETE' });
    fetchLicenses();
}

licenseForm.addEventListener('submit', async e => {
    e.preventDefault();
    const data = {
        userId: licenseForm.userId.value,
        type: licenseForm.type.value,
        durationDays: parseInt(licenseForm.durationDays.value)
    };
    await fetch(`${API_URL}/licenses`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
    licenseForm.reset();
    fetchLicenses();
});

// Inicializar dados
fetchUsers();
fetchLicenses();
</script>
</body>
</html>
